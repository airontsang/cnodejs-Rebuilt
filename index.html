<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="css/itemsList/reset.css" />
    <link rel="stylesheet" href="css/itemsList/pullToRefresh.css" />
    <link rel="stylesheet" href="css/itemsList/itemsList.css" />
    <link rel="stylesheet" href="css/bootstrap.css" />

    <script src="js/jquery-1.8.2.min.js"></script>
    <script src="js/itemsList/iscroll.js"></script>
    <script src="js/itemsList/pullToRefresh.js"></script>
    <style type="text/css" media="all">
        body, html {
            padding: 0;
            margin: 0;
            height: 100%;
            font-family: Arial, Microsoft YaHei;
            color: #111;
        }

        li {
            /*border-bottom: 1px #CCC solid;*/
            text-align: center;
            line-height: 80px;
        }
    </style>
</head>
<body>
    <!--must content ul li,or shoupi-->
    <div id="wrapper">
        <ul class="clearfix">
            <li class="col-lg-4 col-md-4 col-sm-6 col-xs-12 item-card-box">
                <div class="item-card">
                    <div class="item-card-title_pic">
                        <div class="item-card-title">广州聚会</div>
                        <div class="item-card-title_black"></div>
                    </div>
                    <div class="item-card-content">
                        <table class="table">
                            <tbody>
                            <tr>
                                <th scope="row">创建时间</th>
                                <th>2016-9-20</th>
                            </tr>
                            <tr>
                                <th scope="row">收入总额</th>
                                <th>5680</th>

                            </tr>
                            <tr>
                                <th scope="row">当前余额</th>
                                <th>4563</th>
                            </tr>
                            <tr>
                                <th scope="row">是否已发布</th>
                                <th>否</th>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <script>
        function Creat_tr(item,info){
            var tr = document.createElement("tr");
            var td_item = document.createElement("td");
            var td_info = document.createElement("td");
            td_item.innerText = item;
            td_info.innerText = info;
            if(item =="flag" && info == 1){
                tr.className = "success";
                td_info.innerText = "是";
            };
            if(item =="flag" && info == 0){
                td_info.innerText = "否"
            }
            tr.appendChild(td_item);
            tr.appendChild(td_info);
            return tr;
        }

        function Creat_card(item_json){
            var li = document.createElement("li");
            li.className = "col-lg-4 col-md-4 col-sm-6 col-xs-12 item-card-box";
            li.setAttribute("project_id",item_json.projectId);
            var item_card = document.createElement("div");
            item_card.className = "item-card";

            var item_card_title_pic = document.createElement("div");
            item_card_title_pic.className = "item-card-title_pic";
            var item_card_title = document.createElement("div");
            item_card_title.className = "item-card-title";
            item_card_title.innerText = item_json.projectName;
            var item_card_title_black = document.createElement("div");
            item_card_title_black.className = "item-card-title_black";
            item_card_title_pic.appendChild(item_card_title);
            item_card_title_pic.appendChild(item_card_title_black);

            var item_card_content = document.createElement("div");
            item_card_content.className = "item-card-content";
            var card_table = document.createElement("table");
            card_table.className = "table";
            var tbody = document.createElement("tbody");
            card_table.appendChild(tbody);
            item_card_content.appendChild(card_table);
            var ChineseKey = ["说明","项目名称","创建人","创建时间","是否发布"];
            for(let key in item_json){
                if(key == "id"){
                    continue;
                }
                let get_tr = Creat_tr(key,item_json[key]);
                tbody.appendChild(get_tr);
            }

            if(item_json.flag == 1){
                var qrcoder = document.createElement("div");
                qrcoder.className = "qrcoder";
                item_card_title_pic.appendChild(qrcoder);

                qrcoder.onclick = function () {
                    alert("假装有二维码");
                }
            }
            // li.onclick = function () {
            //         window.location.href = "acountDetailes.jsp" + item_json.id;
            // }
            item_card.appendChild(item_card_title_pic);
            item_card.appendChild(item_card_content);
            li.appendChild(item_card);

//            var ul = document.createElement("ul");
//            ul.className = "clearfix";
//            ul.appendChild(li);
            return li;
        }

        function render(datas){
            let target = document.querySelector("#wrapper ul");
            // let target = document.getElementById("testtt");
            for(let i =0;i<datas.length;i++){
                let get_card = Creat_card(datas[i]);
                target.appendChild(get_card);
            }
            setPullStatus(datas.length);
        }

        function setPullStatus(lenght) {
            var loadStatusUp = document.getElementsByClassName("pullUpLabel");
            var loadStatusDown = document.getElementsByClassName("pullDownLabel");

            if((lenght%3)==0){
                loadStatusUp[0].innerHTML = "上拉加载更多";
                loadStatusDown[0].innerHTML = "下拉更新";
            }else {
                loadStatusUp[0].innerHTML = "已经没有更多数据";
            }
        }

        function getJson(page) {
            var waitingBox = document.querySelector("#index-waiting-animition div");
            $.ajax({
                // url : 'getProjectJson',
                async:false,
                url:'js/itemsList/testJson.json',
                type : 'post',
                data : {
                    'pageIndex' :page,
                    'pageSize' : 4,
                    'actionFlag':0
                },
                dataType : 'json',
                beforeSend : function() {
//                    waitingBox.style.display = "block";
                },
                complete : function() {               //仅用于测试
//                    waitingBox.style.display = "none";
                },
                success : function(data) {
                    // var json_Data = eval(data);
                    // var json_Datas = $.parseJSON(json_Data);
                    render(data);
                    console.log(data);
//                    var wra = document.getElementById("wrapper");
//                    $("#wrapper").refresh();
//                    console.log("refresh");
                    generatedCount++;
                }
            });
        }


        refresher.init({
            id: "wrapper",//<------------------------------------------------------------------------------------
            pullDownAction: Refresh,
            pullUpAction: Load
        });
        var generatedCount = 0;
        function Refresh() {
            setTimeout(function () {	// <-- Simulate network congestion, remove setTimeout from production!
//                var el, li, i;
//                el = document.querySelector("#wrapper ul");
//                el.innerHTML = '';
//                for (i = 0; i < 11; i++) {
//                    li = document.createElement('li');
//                    li.appendChild(document.createTextNode('async row ' + (++generatedCount)));
//                    el.insertBefore(li, el.childNodes[0]);
//                }

                wrapper.refresh();/****remember to refresh after  action completed！ ---yourId.refresh(); ----| ****/
            }, 1000);
        }

        function Load() {// <-- Simulate network congestion, remove setTimeout from production!
//                var el, li, i;
//                el = document.querySelector("#wrapper ul");
//                for (i = 0; i < 5; i++) {
//                    li = document.createElement('li');
//                    li.appendChild(document.createTextNode('async row ' + (++generatedCount)));
//                    el.appendChild(li, el.childNodes[0]);
//                }
                getJson(1);
                wrapper.refresh();
                console.log("refresh");
        }
    </script>
</body>
</html>